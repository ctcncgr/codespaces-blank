<!DOCTYPE html>

<html>

<head>
  <meta charset="utf-8" />
  <title>Web-Components Demo</title>
  <!-- CSS framework -->
  <link rel="stylesheet" type="text/css" href="../node_modules/uikit/dist/css/uikit.min.css">
  <script src="../node_modules/uikit/dist/js/uikit.min.js"></script>
  <!-- web components polyfills -->
  <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
  <script src="../node_modules/lit/polyfill-support.js"></script>
  <!-- GraphQL -->
  <script type="text/javascript" src="./graphql.js"></script>
  <!-- web components -->
  <script type="module" src="../dist/index.js"></script>
</head>

<body>

  <div class="uk-container">
    <!-- the custom gene search element -->
    <lis-gene-search-element id="search"></lis-gene-search-element>
  </div>

  <!-- set the search function by property because functions can't be set as attributes -->
  <script type="text/javascript">

    // an example gene search query for the LIS GraphQL API
    const query = `
      query ExampleQuery($keyword: String!, $start: Int, $size: Int) {
        geneSearch(keyword: $keyword, start: $start, size: $size) {
          name
          description
        }
      }
      `;
    
    // the search function given to the LIS gene search Web Component
    function getGenes(formData, page=1) {
      const keyword = formData.get('query');
      const pageSize = 10;
      const start = (page-1)*pageSize;
      const variables = {keyword, start, size: pageSize};
      // returns a Promise that resolves to an array of Gene objects the gene search
      // Web Component knows how to parse: {name: string, description: string}[]
      return graphqlQuery(uri, query, variables)
        .then(({data}) => {
          return data.geneSearch;
        });
    }

    const searchElement = document.getElementById('search');
    searchElement.searchFunction = getGenes;

  </script>

</body>

</html>
